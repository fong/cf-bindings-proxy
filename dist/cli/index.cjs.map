{"version":3,"file":"index.cjs","sources":["../../src/cli/index.ts"],"sourcesContent":["import { spawn } from 'node:child_process';\r\nimport { dirname, resolve } from 'node:path';\r\nimport { fileURLToPath } from 'node:url';\r\n\r\n// eslint-disable-next-line @typescript-eslint/naming-convention\r\nconst __filename = fileURLToPath(import.meta.url);\r\n// eslint-disable-next-line @typescript-eslint/naming-convention\r\nconst __dirname = dirname(__filename);\r\n\r\nconst pad = (num: number) => (num < 10 ? `0${num}` : num);\r\n\r\n/**\r\n * Spawns wrangler dev mode with the binding proxy template.\r\n */\r\nexport const spawnDevMode = async () => {\r\n\tconst passThroughArgs = process.argv.slice(2);\r\n\r\n\tconst suffix = process.platform === 'win32' ? '.cmd' : '';\r\n\tconst executor = `npx${suffix}`;\r\n\r\n\t// eslint-disable-next-line no-console\r\n\tconsole.log(`\r\n-----------------\r\nStarting cf-bindings-proxy...\r\n\r\nWARNING: This is an experimental proxy for interfacing with bindings remotely.\r\n\r\nPlease report any issues to https://github.com/james-elicx/cf-bindings-proxy\r\n-----------------\r\n`);\r\n\r\n\tif (!passThroughArgs.includes('compatibility-date')) {\r\n\t\tconst date = new Date();\r\n\t\tconst formatted = `${date.getUTCFullYear()}-${pad(date.getUTCMonth() + 1)}-${pad(\r\n\t\t\tdate.getUTCDate(),\r\n\t\t)}`;\r\n\t\tpassThroughArgs.push(`--compatibility-date=${formatted}`);\r\n\t}\r\n\r\n\tconst wrangler = spawn(\r\n\t\texecutor,\r\n\t\t['wrangler', 'pages', 'dev', resolve(__dirname, 'template'), '--port=8799', ...passThroughArgs],\r\n\t\t{ stdio: 'inherit' },\r\n\t);\r\n\r\n\tawait new Promise((res) => {\r\n\t\twrangler.on('close', (code) => {\r\n\t\t\tres(code);\r\n\t\t});\r\n\t});\r\n};\r\n\r\nspawnDevMode();\r\n"],"names":["__filename","fileURLToPath","_documentCurrentScript","__dirname","dirname","pad","num","spawnDevMode","passThroughArgs","executor","date","formatted","wrangler","spawn","resolve","res","code"],"mappings":"yNAKA,MAAMA,EAAaC,EAAAA,cAAc,OAAA,SAAA,IAAA,QAAA,KAAA,EAAA,cAAA,UAAA,EAAA,KAAAC,GAAAA,EAAA,KAAA,IAAA,IAAA,gBAAA,SAAA,OAAA,EAAA,IAAe,EAE1CC,EAAYC,EAAAA,QAAQJ,CAAU,EAE9BK,EAAOC,GAAiBA,EAAM,GAAK,IAAIA,CAAG,GAAKA,EAKxCC,EAAe,SAAY,CACvC,MAAMC,EAAkB,QAAQ,KAAK,MAAM,CAAC,EAGtCC,EAAW,MADF,QAAQ,WAAa,QAAU,OAAS,EAC1B,GAa7B,GAVA,QAAQ,IAAI;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,CAQZ,EAEI,CAACD,EAAgB,SAAS,oBAAoB,EAAG,CAC9C,MAAAE,MAAW,KACXC,EAAY,GAAGD,EAAK,eAAgB,CAAA,IAAIL,EAAIK,EAAK,YAAY,EAAI,CAAC,CAAC,IAAIL,EAC5EK,EAAK,WAAW,CAChB,CAAA,GACeF,EAAA,KAAK,wBAAwBG,CAAS,EAAE,CACzD,CAEA,MAAMC,EAAWC,EAAA,MAChBJ,EACA,CAAC,WAAY,QAAS,MAAOK,EAAA,QAAQX,EAAW,UAAU,EAAG,cAAe,GAAGK,CAAe,EAC9F,CAAE,MAAO,SAAU,CAAA,EAGd,MAAA,IAAI,QAASO,GAAQ,CACjBH,EAAA,GAAG,QAAUI,GAAS,CAC9BD,EAAIC,CAAI,CAAA,CACR,CAAA,CACD,CACF,EAEAT,EAAa"}
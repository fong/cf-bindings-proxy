{"version":3,"file":"index.js","sources":["../../src/cli/index.ts"],"sourcesContent":["import { spawn } from 'node:child_process';\r\nimport { dirname, resolve } from 'node:path';\r\nimport { fileURLToPath } from 'node:url';\r\n\r\n// eslint-disable-next-line @typescript-eslint/naming-convention\r\nconst __filename = fileURLToPath(import.meta.url);\r\n// eslint-disable-next-line @typescript-eslint/naming-convention\r\nconst __dirname = dirname(__filename);\r\n\r\nconst pad = (num: number) => (num < 10 ? `0${num}` : num);\r\n\r\n/**\r\n * Spawns wrangler dev mode with the binding proxy template.\r\n */\r\nexport const spawnDevMode = async () => {\r\n\tconst passThroughArgs = process.argv.slice(2);\r\n\r\n\tconst suffix = process.platform === 'win32' ? '.cmd' : '';\r\n\tconst executor = `npx${suffix}`;\r\n\r\n\t// eslint-disable-next-line no-console\r\n\tconsole.log(`\r\n-----------------\r\nStarting cf-bindings-proxy...\r\n\r\nWARNING: This is an experimental proxy for interfacing with bindings remotely.\r\n\r\nPlease report any issues to https://github.com/james-elicx/cf-bindings-proxy\r\n-----------------\r\n`);\r\n\r\n\tif (!passThroughArgs.includes('compatibility-date')) {\r\n\t\tconst date = new Date();\r\n\t\tconst formatted = `${date.getUTCFullYear()}-${pad(date.getUTCMonth() + 1)}-${pad(\r\n\t\t\tdate.getUTCDate(),\r\n\t\t)}`;\r\n\t\tpassThroughArgs.push(`--compatibility-date=${formatted}`);\r\n\t}\r\n\r\n\tconst wrangler = spawn(\r\n\t\texecutor,\r\n\t\t['wrangler', 'pages', 'dev', resolve(__dirname, 'template'), '--port=8799', ...passThroughArgs],\r\n\t\t{ stdio: 'inherit' },\r\n\t);\r\n\r\n\tawait new Promise((res) => {\r\n\t\twrangler.on('close', (code) => {\r\n\t\t\tres(code);\r\n\t\t});\r\n\t});\r\n};\r\n\r\nspawnDevMode();\r\n"],"names":["__filename","fileURLToPath","__dirname","dirname","pad","num","spawnDevMode","passThroughArgs","executor","date","formatted","wrangler","spawn","resolve","res","code"],"mappings":";;;AAKA,MAAMA,IAAaC,EAAc,YAAY,GAAG,GAE1CC,IAAYC,EAAQH,CAAU,GAE9BI,IAAM,CAACC,MAAiBA,IAAM,KAAK,IAAIA,CAAG,KAAKA,GAKxCC,IAAe,YAAY;AACvC,QAAMC,IAAkB,QAAQ,KAAK,MAAM,CAAC,GAGtCC,IAAW,MADF,QAAQ,aAAa,UAAU,SAAS,EAC1B;AAa7B,MAVA,QAAQ,IAAI;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,CAQZ,GAEI,CAACD,EAAgB,SAAS,oBAAoB,GAAG;AAC9C,UAAAE,wBAAW,QACXC,IAAY,GAAGD,EAAK,eAAgB,CAAA,IAAIL,EAAIK,EAAK,YAAY,IAAI,CAAC,CAAC,IAAIL;AAAA,MAC5EK,EAAK,WAAW;AAAA,IAChB,CAAA;AACe,IAAAF,EAAA,KAAK,wBAAwBG,CAAS,EAAE;AAAA,EACzD;AAEA,QAAMC,IAAWC;AAAA,IAChBJ;AAAA,IACA,CAAC,YAAY,SAAS,OAAOK,EAAQX,GAAW,UAAU,GAAG,eAAe,GAAGK,CAAe;AAAA,IAC9F,EAAE,OAAO,UAAU;AAAA,EAAA;AAGd,QAAA,IAAI,QAAQ,CAACO,MAAQ;AACjB,IAAAH,EAAA,GAAG,SAAS,CAACI,MAAS;AAC9B,MAAAD,EAAIC,CAAI;AAAA,IAAA,CACR;AAAA,EAAA,CACD;AACF;AAEAT,EAAa;"}